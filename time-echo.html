<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0">
<title>æœªæ¥å›éŸ³</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
body{
  font-family:'PingFang SC','Segoe UI',sans-serif;
  background:linear-gradient(180deg,#fff8f4 0%,#ffffff 100%);
  min-height:100vh;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  overflow:hidden;
  position:relative;
}
.dot{position:absolute;border-radius:50%;opacity:.4;filter:blur(60px);animation:float 10s ease-in-out infinite alternate;z-index:0;}
.dot1{width:240px;height:240px;background:radial-gradient(circle,#ffd6a5,#ffb5a7);top:10%;left:5%;}
.dot2{width:280px;height:280px;background:radial-gradient(circle,#bde0fe,#caffbf);bottom:5%;right:5%;animation-delay:3s;}
@keyframes float{from{transform:translateY(0)}to{transform:translateY(-25px)}}

/* ä¿¡å°å¤–è§‚ */
.envelope{
  position:relative;width:90%;max-width:640px;height:380px;
  background:linear-gradient(145deg,#fff3e0,#ffe7eb);
  border-radius:10px;box-shadow:0 10px 25px rgba(255,190,200,.3);
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;overflow:hidden;animation:gentlePulse 3.5s ease-in-out infinite;
}
@keyframes gentlePulse{
  0%,100%{transform:rotate(0deg) scale(1);}
  25%{transform:rotate(-1deg) scale(1.02);}
  50%{transform:rotate(1deg) scale(1.02);}
  75%{transform:rotate(-1deg) scale(1);}
}
.envelope.open{animation:none;cursor:default;}
.flap{
  position:absolute;top:0;left:0;width:100%;height:50%;
  background:linear-gradient(180deg,#ffe8ea 0%,#fff 100%);
  clip-path:polygon(0 0,100% 0,50% 100%);
  transform-origin:top;
  transition:transform 1s ease-in-out;
  z-index:2;
}
.envelope.open .flap{transform:rotateX(180deg);}

/* ä¿¡çº¸å®¹å™¨ */
.container{
  position:absolute;bottom:0;
  width:90%;max-width:600px;
  background:#fffdfb;border-radius:18px;
  box-shadow:0 6px 18px rgba(0,0,0,.1);
  padding:24px 20px;z-index:3;
}
h1{text-align:center;font-size:2rem;
  background:linear-gradient(135deg,#ffb5a7,#bde0fe);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;}
.subtitle{text-align:center;color:#666;margin-bottom:20px;}

textarea{
  width:100%;min-height:120px;border:2px solid #f0f0f0;
  border-radius:14px;padding:15px;font-size:16px;background:#fff;
  resize:vertical;transition:.3s;
}
textarea:focus{border-color:#ffb5a7;box-shadow:0 0 6px rgba(255,181,167,.3);outline:none;}
button{
  background:linear-gradient(135deg,#ffdac1,#bde0fe);
  border:none;border-radius:12px;font-size:17px;font-weight:600;
  padding:15px;width:100%;margin-top:10px;cursor:pointer;
  transition:.3s;color:#333;
}
button:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(255,181,167,.25);}

/* ä¿¡çº¸å±•ç¤ºå±‚ */
#letterOverlay{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(255,255,255,0.96);
  backdrop-filter:blur(5px);
  display:none;flex-direction:column;
  align-items:center;justify-content:center;
  padding:20px;
  z-index:10;
  animation:fadeIn .8s ease forwards;
}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
#futureText{
  max-width:90%;
  max-height:85vh;
  overflow:auto;
  line-height:1.8;
  background:#fffaf7;
  border-left:4px solid #ffd6a5;
  border-radius:16px;
  box-shadow:0 8px 25px rgba(0,0,0,.1);
  padding:20px;
  transition:transform 0.5s ease,box-shadow 1s ease;
  text-align:left;
  white-space:pre-wrap;
}
.playing{animation:glow 2s ease-in-out infinite alternate;}
@keyframes glow{
  0%{box-shadow:0 0 10px rgba(255,181,167,0.2);}
  100%{box-shadow:0 0 25px rgba(255,181,167,0.6);}
}

@media(max-width:480px){
  #futureText{padding:15px;}
}
</style>
</head>
<body>
<div class="dot dot1"></div>
<div class="dot dot2"></div>

<div class="envelope" id="envelope" onclick="openEnvelope()">
  <div class="flap"></div>

  <div class="container" id="letterContainer">
    <h1>æœªæ¥å›éŸ³</h1>
    <p class="subtitle">å†™ä¸‹æ­¤åˆ»çš„å¿ƒå£°ï¼Œé‡è§æœªæ¥çš„è‡ªå·± ğŸ’Œ</p >

    <textarea id="userInput" placeholder="å†™ä¸‹ä½ çš„æƒ³æ³•ã€å›°æƒ‘æˆ–æ„¿æœ›..."></textarea>
    <button id="generateBtn" onclick="generateCapsule()">âœ¨ ç”Ÿæˆæœªæ¥å›éŸ³</button>

    <div id="loading" style="display:none;text-align:center;margin-top:20px;color:#888;">ğŸ¤– AI æ­£åœ¨æ„æ€æ¥è‡ªæœªæ¥çš„ä¿¡ä»¶...</div>
  </div>
</div>

<div id="letterOverlay">
  <p id="futureText"></p >
  <div style="margin-top:20px;display:flex;gap:10px;">
    <button onclick="playVoice()">â–¶ï¸ æ’­æ”¾è¯­éŸ³</button>
    <button onclick="closeLetter()">ğŸ“© æ”¶å›ä¿¡çº¸</button>
  </div>
</div>

<script>
let opened=false,currentVoiceText='',utter=null;

function openEnvelope(){
  if(opened)return;
  document.getElementById('envelope').classList.add('open');
  opened=true;
}

/* ---- æ™ºèƒ½å†…å®¹ç”Ÿæˆï¼šæ•´åˆå¢å¼ºç‰ˆé€»è¾‘ ---- */
function generateDynamicLetter(input){
  const today=new Date().toLocaleDateString('zh-CN',{year:'numeric',month:'long',day:'numeric',weekday:'long'});
  const topics={
    work:['å·¥ä½œ','èŒåœº','å°±ä¸š','è¿·èŒ«','å®ä¹ ','åŠ ç­','å‡èŒ','åŒäº‹','ä¸Šå¸','èŒä¸šè§„åˆ’','è·³æ§½'],
    study:['å­¦ä¹ ','è€ƒè¯•','æˆç»©','è€ƒç ”','æˆé•¿','çŸ¥è¯†','è¯»ä¹¦','æ•™è‚²','è¯¾ç¨‹','ä¸“ä¸š'],
    love:['çˆ±æƒ…','æ‹çˆ±','å–œæ¬¢','åˆ†æ‰‹','ä»–','å¥¹','å¿ƒåŠ¨','æ„Ÿæƒ…','å©šå§»','ä¼´ä¾£'],
    family:['å®¶åº­','çˆ¶æ¯','å®¶äºº','äº²æƒ…','å­©å­','æ²Ÿé€š','çˆ¶äº²','æ¯äº²','å…„å¼Ÿå§å¦¹'],
    friend:['æœ‹å‹','å‹æƒ…','å­¤ç‹¬','è¯¯ä¼š','ä¿¡ä»»','ç¤¾äº¤','äººé™…','çŸ¥å·±','ä¼™ä¼´'],
    future:['æœªæ¥','æ¢¦æƒ³','å¸Œæœ›','ç†æƒ³','æ–¹å‘','ç›®æ ‡','å‰é€”','è§„åˆ’'],
    mood:['ç„¦è™‘','æƒ…ç»ª','éš¾è¿‡','å¤±è½','æŠ‘éƒ','ä½è½','çƒ¦æ¼','å¿§æ„'],
    self:['è‡ªæˆ‘','äººç”Ÿ','æ„ä¹‰','æˆé•¿','ä¿¡å¿µ','é€‰æ‹©','ä»·å€¼','å†…å¿ƒ']
  };

  let matchKeys=[];
  for(const key in topics){
    if(topics[key].some(k=>input.includes(k))) matchKeys.push(key);
  }

  let letter=`äº²çˆ±çš„è‡ªå·±ï¼š\n\nä»Šå¤©ï¼Œå½“æˆ‘çœ‹åˆ°ä½ å†™ä¸‹â€œ${input}â€æ—¶ï¼Œæˆ‘ä»¿ä½›èƒ½è§¦æ‘¸åˆ°ä½ æ­¤åˆ»çš„æƒ…ç»ªã€‚æˆ–è®¸æœ‰äº›ä¸å®‰ï¼Œæœ‰äº›æœŸå¾…ï¼Œä¹Ÿæœ‰äº›æ€è€ƒã€‚åˆ«å¿˜äº†ï¼Œæ­£æ˜¯è¿™äº›å¤æ‚çš„æƒ…ç»ªï¼Œæ„æˆäº†çœŸå®è€Œé²œæ´»çš„ä½ ã€‚\n\n`;

  if(matchKeys.includes('work')) letter+=`å…³äºå·¥ä½œçš„è¿·èŒ«ï¼Œè¯·ä¸è¦æ€¥äºç»™è‡ªå·±å®šç­”æ¡ˆã€‚æˆé•¿çš„è·¯ä¸Šï¼Œæ¯ä¸€æ¬¡ä¸ç¡®å®šéƒ½æ˜¯æ–°çš„èµ·ç‚¹ã€‚æœªæ¥çš„ä½ ï¼Œä¼šæ„Ÿæ¿€ç°åœ¨åŠªåŠ›æ€è€ƒçš„è‡ªå·±ã€‚è¯·ç›¸ä¿¡ï¼Œè„šä¸‹çš„è·¯æ­£åœ¨æ…¢æ…¢å˜äº®ã€‚\n\n`;
  if(matchKeys.includes('study')) letter+=`åœ¨å­¦ä¹ çš„æ—…ç¨‹ä¸­ï¼Œè¯·è®°ä½ï¼šåˆ†æ•°å¹¶ä¸æ˜¯å”¯ä¸€çš„ä»·å€¼ã€‚æ¯ä¸€æ¬¡ç†è§£ã€æ¯ä¸€æ¬¡é¡¿æ‚Ÿï¼Œéƒ½æ˜¯ä½ æ€æƒ³çš„è·ƒè¿ã€‚å³ä½¿å‰è·¯æ¼«é•¿ï¼Œä¹Ÿè¯·å¸¦ç€çƒ­çˆ±ç»§ç»­å‰è¡Œã€‚\n\n`;
  if(matchKeys.includes('love')) letter+=`å…³äºçˆ±æƒ…ï¼Œè¯·æ¸©æŸ”åœ°ç›¸ä¿¡ã€‚ä½ å€¼å¾—è¢«çˆ±ï¼Œä¹Ÿå€¼å¾—çˆ±äººã€‚æ— è®ºç”œèœœè¿˜æ˜¯é—æ†¾ï¼Œå®ƒä»¬éƒ½è®©ä½ æ›´æ‡‚å¾—ä½•ä¸ºçœŸå¿ƒã€‚æœªæ¥çš„æŸå¤©ï¼Œå½“ä½ å†æ¬¡å¿ƒåŠ¨æ—¶ï¼Œä½ ä¼šæ„Ÿè°¢ç°åœ¨ä»æ„¿æ„ç›¸ä¿¡çˆ±çš„è‡ªå·±ã€‚\n\n`;
  if(matchKeys.includes('family')) letter+=`å®¶äººçš„å…³æ€€æˆ–è®¸ä¸å¸¸è¯´å‡ºå£ï¼Œä½†é‚£ä»½ç‰µæŒ‚ä»æœªè¿œç¦»ã€‚è¯·æŠ½æ—¶é—´å»è¡¨è¾¾çˆ±ï¼Œå› ä¸ºâ€œæˆ‘çˆ±ä½ â€æ°¸è¿œä¸ä¼šå«Œå¤šã€‚\n\n`;
  if(matchKeys.includes('friend')) letter+=`å‹æƒ…æœ‰æ—¶æ·¡å¦‚æ°´ï¼Œå´æœ€èƒ½è§£æ¸´ã€‚åˆ«æ€•å¤±å»æŸäº›äººï¼Œå› ä¸ºæ¯æ®µå…³ç³»çš„ç»“æŸéƒ½æ„å‘³ç€æ–°çš„ç¼˜åˆ†å³å°†å¼€å§‹ã€‚\n\n`;
  if(matchKeys.includes('future')) letter+=`å…³äºæœªæ¥ï¼Œä¸å¿…æƒ¶æã€‚å®ƒå¹¶éé¥ä¸å¯åŠçš„æ¢¦ï¼Œè€Œæ˜¯ä½ æ¯å¤©ç§¯ç´¯çš„å°å°å‹‡æ°”ã€‚é‚£äº›ä½ ä»Šå¤©çš„åŠªåŠ›ï¼Œéƒ½ä¼šæˆä¸ºæœªæ¥çš„æ¸©æŸ”å›å“ã€‚\n\n`;
  if(matchKeys.includes('mood')) letter+=`æƒ…ç»ªèµ·ä¼å¹¶ä¸ä»£è¡¨ä½ å¤±è´¥äº†ï¼Œè€Œæ˜¯è¯´æ˜ä½ ä»ç„¶çƒ­çˆ±ç”Ÿæ´»ã€‚å“ªæ€•æš‚æ—¶é™·å…¥ä½è°·ï¼Œä¹Ÿè¯·è®°ä½ï¼šæƒ…ç»ªä¼šæµèµ°ï¼Œè€Œä½ çš„æœ¬è´¨å§‹ç»ˆæ¸©æŸ”è€Œåšå®šã€‚\n\n`;
  if(matchKeys.includes('self')) letter+=`ä½ ä¸å¿…æˆä¸ºæ‰€æœ‰äººæœŸå¾…çš„æ ·å­ã€‚äººç”Ÿçš„æ„ä¹‰ï¼Œä»æ¥ä¸åœ¨åˆ«äººçš„ç›®å…‰ä¸­ï¼Œè€Œåœ¨ä½ å¦‚ä½•çœ‹å¾…è‡ªå·±ã€‚å…è®¸è‡ªå·±ä¸å®Œç¾ï¼Œè¿™æ ·ä½ æ‰æ›´åƒäººï¼Œæ›´å€¼å¾—è¢«çˆ±ã€‚\n\n`;
  if(matchKeys.length===0) letter+=`æˆ‘æ„Ÿå—åˆ°ä½ åœ¨æ€è€ƒï¼Œå´è¿˜æ‰¾ä¸åˆ°ç¡®åˆ‡çš„æ–¹å‘ã€‚æ²¡å…³ç³»â€”â€”å›°æƒ‘æœ¬èº«ï¼Œå°±æ˜¯çµé­‚åœ¨æˆé•¿ã€‚è¯·çæƒœè¿™æ®µä¸è‡ªå·±çš„å¯¹è¯ï¼Œå®ƒä¼šåœ¨æœªæ¥å‘å‡ºå…‰ã€‚\n\n`;

  letter+=`æ— è®ºä½ æ­£åœ¨ç»å†ä»€ä¹ˆï¼Œè¯·ç›¸ä¿¡â€”â€”æ—¶é—´ä¼šæ¸©æŸ”åœ°å›ç­”æ‰€æœ‰ç–‘é—®ã€‚\n\næœªæ¥çš„ä½ ï¼Œä¹Ÿè®¸æ­£åœ¨å¾®ç¬‘ç€è¯»è¿™å°ä¿¡ï¼Œå¯¹ç°åœ¨çš„ä½ å……æ»¡æ„Ÿæ¿€ã€‚\n\næœªæ¥çš„ä½ \n${today}`;
  return letter;
}

/* è‡ªåŠ¨å­—ä½“è°ƒèŠ‚ */
function autoFitFont(el){
  let fontSize=18;
  el.style.fontSize=fontSize+'px';
  while(el.scrollHeight>window.innerHeight*0.8 && fontSize>12){
    fontSize--;el.style.fontSize=fontSize+'px';
  }
}

/* ç”Ÿæˆæœªæ¥å›éŸ³ */
async function generateCapsule(){
  const input=document.getElementById('userInput').value.trim();
  if(!input)return alert('è¯·å…ˆå†™ä¸‹ä¸€äº›å†…å®¹å§ï¼');
  const btn=document.getElementById('generateBtn');
  const loading=document.getElementById('loading');
  const letterOverlay=document.getElementById('letterOverlay');
  const textBox=document.getElementById('futureText');

  btn.disabled=true;loading.style.display='block';
  await new Promise(r=>setTimeout(r,1200));

  const letter=generateDynamicLetter(input);
  textBox.textContent=letter;
  currentVoiceText=letter;

  autoFitFont(textBox);
  loading.style.display='none';
  letterOverlay.style.display='flex';
  btn.disabled=false;
  openEnvelope();
}

/* å…³é—­ä¿¡çº¸ */
function closeLetter(){
  stopVoice();
  document.getElementById('letterOverlay').style.display='none';
}

/* è¯­éŸ³åŠŸèƒ½ */
function playVoice(){
  if(!currentVoiceText)return;
  stopVoice();
  if(!('speechSynthesis' in window)){alert('æ­¤è®¾å¤‡æš‚ä¸æ”¯æŒè¯­éŸ³åˆæˆ');return;}
  utter=new SpeechSynthesisUtterance(currentVoiceText);
  utter.lang='zh-CN';utter.rate=0.93;utter.pitch=1.0;
  const textBox=document.getElementById('futureText');
  textBox.classList.add('playing');
  utter.onend=()=>textBox.classList.remove('playing');
  speechSynthesis.speak(utter);
}
function stopVoice(){
  if('speechSynthesis' in window)speechSynthesis.cancel();
  document.getElementById('futureText').classList.remove('playing');
}
</script>
</body>
</html>
